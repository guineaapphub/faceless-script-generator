<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Faceless Script Generator</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #39ff14; /* neon green */
      --primary-glow: rgba(57,255,20,0.5);
      --bg-light: #ffffff;
      --bg-dark: #0d0d0d;
      --text-light: #0d0d0d;
      --text-dark: #ffffff;
      --border: #2d2d2d;
      --card-light: #ffffff;
      --card-dark: #111111;
    }

    body.light {
      background: var(--bg-light);
      color: var(--text-light);
    }

    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    body {
      font-family: "Rubik", sans-serif;
      margin: 0;
      padding: 0;
      transition: 0.3s ease;
    }

    .container {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 16px 40px;
    }

    h1 {
      text-align: center;
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 4px;
      text-shadow: 0 0 8px var(--primary-glow);
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 22px;
    }

    /* Ad banner placeholder */
    .ad-box {
      width: 100%;
      min-height: 90px;
      border: 1px dashed var(--border);
      border-radius: 10px;
      margin: 16px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      font-size: 13px;
    }

    .panel {
      background: var(--card-light);
      border-radius: 14px;
      padding: 18px 18px 20px;
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }

    body.dark .panel {
      background: var(--card-dark);
    }

    label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      font-size: 14px;
    }

    input[type="text"],
    input[type="password"],
    textarea,
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: inherit;
      font-size: 14px;
      margin-bottom: 14px;
      box-sizing: border-box;
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 8px var(--primary-glow);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    .row > .col {
      flex: 1 1 180px;
    }

    .slider-label {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .slider-value {
      font-size: 12px;
      opacity: 0.75;
      margin-top: 2px;
    }

    input[type="range"] {
      width: 100%;
    }

    .toggles {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    .toggles label {
      font-weight: 500;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      margin-bottom: 0;
    }

    button {
      border: none;
      padding: 11px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
      display: inline-block;
    }

    .btn-primary {
      background: var(--primary);
      color: #000;
    }

    .btn-secondary {
      background: transparent;
      color: inherit;
      border: 1px solid var(--border);
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: 0 0 8px var(--primary-glow);
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    #output {
      white-space: pre-wrap;
      line-height: 1.55rem;
      font-size: 1.02rem;
      min-height: 140px;
    }

    .theme-switch {
      margin-bottom: 14px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    select#themeSelect {
      width: 140px;
    }

    /* API accordion */
    .api-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    .api-header span:last-child {
      font-size: 18px;
    }

    .api-body {
      margin-top: 10px;
      display: none;
    }

    .api-body.open {
      display: block;
    }

    .api-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .api-row input {
      flex: 1 1 220px;
      margin-bottom: 0;
    }

    .api-eye-btn {
      flex: 0 0 auto;
      padding: 8px 10px;
      font-size: 14px;
      line-height: 1;
    }

    .api-help {
      font-size: 12px;
      margin-top: 6px;
      opacity: 0.85;
    }

    .api-help a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }

    .api-status {
      font-size: 12px;
      margin-top: 6px;
      min-height: 16px;
    }

    .api-status.ok {
      color: #2e7d32;
    }

    .api-status.err {
      color: #c62828;
    }

    @media (max-width: 600px) {
      .button-row {
        flex-direction: column;
      }
    }
  </style>
</head>

<body class="light">
  <div class="container">

    <div class="theme-switch">
      <span>Theme:</span>
      <select id="themeSelect">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
    </div>

    <h1>Roblox Rant Generator</h1>
    <div class="subtitle">Type your theme, build your rant, bye-bye noob.</div>

    <!-- AD PLACEMENT TOP -->
    <div class="ad-box">Ad Placeholder ‚Äî Top Banner</div>

    <!-- MAIN CONTROLS -->
    <div class="panel">
      <label for="topicInput">Topic / Theme</label>
      <input id="topicInput" type="text" placeholder="e.g. school, lag, strict parents, annoying friends, adulting, social media" />

      <label for="pasteInput">Paste Your Rant Script Here (optional)</label>
      <textarea id="pasteInput" placeholder="Paste any rant script here to rewrite &amp; improve it in a Roblox-rant style..."></textarea>

      <label for="narratorSelect">Rant Narrator</label>
      <select id="narratorSelect">
        <option value="male" selected>Male Rant Narrator</option>
        <option value="neutral">Gender-neutral Narrator</option>
        <option value="female">Slightly Sassy / Feminine Narrator</option>
      </select>

      <div class="row">
        <div class="col">
          <div class="slider-label">Intensity</div>
          <input id="intensitySlider" type="range" min="1" max="4" value="2" />
          <div id="intensityLabel" class="slider-value">Cool</div>
        </div>

        <div class="col">
          <div class="slider-label">Length</div>
          <input id="lengthSlider" type="range" min="1" max="4" value="2" />
          <div id="lengthLabel" class="slider-value">Medium rant</div>
        </div>
      </div>

      <div class="toggles">
        <label><input id="includeSlang" type="checkbox" checked /> Include slang</label>
        <label><input id="spicyMode" type="checkbox" /> Spicy Mode (PG-13)</label>
      </div>

      <div class="button-row">
        <button id="generateBtn" class="btn-primary">Generate Rant</button>
        <button id="rewriteBtn" class="btn-secondary">Rewrite &amp; Improve</button>
        <button id="shuffleBtn" class="btn-secondary">Shuffle Variation</button>
        <button id="punchierBtn" class="btn-secondary">Make it unique</button>
        <button id="copyBtn" class="btn-secondary">Copy Script</button>
      </div>
    </div>

    <!-- AD PLACEMENT MIDDLE -->
    <div class="ad-box">Ad Placeholder ‚Äî Mid Content</div>
    <!-- GEMINI API SETTINGS (COLLAPSIBLE) -->
    <div class="panel">
      <div id="apiHeader" class="api-header">
        <span>Gemini API Settings</span>
        <span id="apiChevron">‚ñº</span>
      </div>

      <div id="apiBody" class="api-body">
        <div class="api-row">
          <input id="apiKeyInput" type="password" placeholder="Enter your Gemini API key" />
          <button id="toggleKeyBtn" class="btn-secondary api-eye-btn" type="button">üëÅ</button>
          <button id="saveKeyBtn" class="btn-secondary" style="flex:0 0 auto;">Save Key</button>
          <button id="clearKeyBtn" class="btn-secondary" style="flex:0 0 auto;">Clear</button>
        </div>

        <div class="api-help">
          To get your Gemini API Key, visit Google AI Studio.  
          Click "Get API Key" and then "Create API Key".  
          Your key is stored securely in your browser's local storage.  
          <br><br>
          <a href="https://aistudio.google.com/app/api-keys" target="_blank" rel="noopener noreferrer">
            Get your Gemini API key here ‚Üí
          </a>
        </div>

        <div id="apiStatus" class="api-status"></div>
      </div>
    </div>

    <!-- OUTPUT -->
    <div class="panel">
      <label>Generated Rant Script</label>
      <div id="output">Your rant will appear here...</div>
    </div>

    <!-- AD PLACEMENT BOTTOM -->
    <div class="ad-box">Ad Placeholder ‚Äî Footer Banner</div>

    <!-- FOOTER WITH DISCORD BUTTON + TEXT -->
    <div style="text-align:center; margin-top:20px;">
      <a
        href="https://discord.gg/Bbz2N7xxwp"
        target="_blank"
        rel="noopener noreferrer"
        style="
          display:inline-block;
          padding:10px 16px;
          background:var(--primary);
          color:#000;
          border-radius:8px;
          font-weight:700;
          text-decoration:none;
          box-shadow:0 0 6px var(--primary-glow);
          transition:0.2s;
        "
        onmouseover="this.style.opacity='0.85'"
        onmouseout="this.style.opacity='1'"
      >
        Join our Discord Community ‚Üí
      </a>
      <div style="font-size:12px; margin-top:6px; opacity:0.85;">
        Get support, updates, and help from other creators.
      </div>
    </div>

  </div> <!-- END CONTAINER -->

  <!-- JAVASCRIPT -->
  <script>
    // ---------- THEME HANDLING ----------
    const themeSelect = document.getElementById('themeSelect');
    const savedTheme = localStorage.getItem('fsg-theme') || 'auto';

    function applyTheme(mode) {
      document.body.classList.remove('light', 'dark');
      if (mode === 'auto') {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.body.classList.add(prefersDark ? 'dark' : 'light');
      } else {
        document.body.classList.add(mode);
      }
    }

    themeSelect.value = savedTheme;
    applyTheme(savedTheme);

    themeSelect.addEventListener('change', () => {
      const val = themeSelect.value;
      localStorage.setItem('fsg-theme', val);
      applyTheme(val);
    });

    // ---------- SLIDER LABELS ----------
    const intensitySlider = document.getElementById('intensitySlider');
    const lengthSlider = document.getElementById('lengthSlider');
    const intensityLabel = document.getElementById('intensityLabel');
    const lengthLabel = document.getElementById('lengthLabel');

    function updateIntensityLabel() {
      const v = Number(intensitySlider.value);
      if (v === 1) intensityLabel.textContent = 'Very chill';
      else if (v === 2) intensityLabel.textContent = 'Cool';
      else if (v === 3) intensityLabel.textContent = 'Salty';
      else intensityLabel.textContent = 'Full meltdown';
    }

    function updateLengthLabel() {
      const v = Number(lengthSlider.value);
      if (v === 1) lengthLabel.textContent = 'Short rant';
      else if (v === 2) lengthLabel.textContent = 'Medium rant';
      else if (v === 3) lengthLabel.textContent = 'Long rant';
      else lengthLabel.textContent = 'Max rant';
    }

    intensitySlider.addEventListener('input', updateIntensityLabel);
    lengthSlider.addEventListener('input', updateLengthLabel);
    updateIntensityLabel();
    updateLengthLabel();

    // ---------- API PANEL (COLLAPSIBLE) ----------
    const apiHeader = document.getElementById('apiHeader');
    const apiBody = document.getElementById('apiBody');
    const apiChevron = document.getElementById('apiChevron');

    apiHeader.addEventListener('click', () => {
      const open = apiBody.classList.toggle('open');
      apiChevron.textContent = open ? '‚ñ≤' : '‚ñº';
    });

    // ---------- GEMINI API KEY STORAGE ----------
    const apiKeyInput = document.getElementById('apiKeyInput');
    const apiStatus = document.getElementById('apiStatus');
    const saveKeyBtn = document.getElementById('saveKeyBtn');
    const clearKeyBtn = document.getElementById('clearKeyBtn');
    const toggleKeyBtn = document.getElementById('toggleKeyBtn');

    function getApiKey() {
      return localStorage.getItem('fsg-gemini-key') || '';
    }

    function showStatus(msg, type) {
      apiStatus.textContent = msg;
      apiStatus.className = 'api-status ' + (type || '');
    }

    // Load existing key
    const storedKey = getApiKey();
    if (storedKey) {
      apiKeyInput.value = storedKey;
      showStatus('Gemini API key loaded from your browser.', 'ok');
      apiBody.classList.add('open');
      apiChevron.textContent = '‚ñ≤';
    }

    // Eye toggle: show / hide API key
    if (toggleKeyBtn) {
      toggleKeyBtn.addEventListener('click', () => {
        const isPassword = apiKeyInput.type === 'password';
        apiKeyInput.type = isPassword ? 'text' : 'password';
        toggleKeyBtn.textContent = isPassword ? 'üôà' : 'üëÅ';
      });
    }

    saveKeyBtn.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (!key) {
        showStatus('Please enter a valid Gemini API key.', 'err');
        return;
      }
      localStorage.setItem('fsg-gemini-key', key);
      showStatus('API key saved in your browser (local only).', 'ok');
    });

    clearKeyBtn.addEventListener('click', () => {
      localStorage.removeItem('fsg-gemini-key');
      apiKeyInput.value = '';
      showStatus('API key cleared. Add one to use AI features.', 'err');
    });
    // ---------- GEMINI CALL (FULLY FIXED ‚Äî NO MORE 404) ----------
    async function callGemini(promptText) {
      const key = getApiKey();
      if (!key) {
        showStatus('Add your Gemini API key to generate AI rants.', 'err');
        throw new Error('No API key');
      }

      showStatus('Talking to Gemini...', '');

      const body = {
        contents: [{
          role: "user",
          parts: [{ text: promptText }]
        }]
      };

      // ‚úÖ Correct 2025 endpoint (404-proof)
      const url =
     'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-lite:generateContent?key='

        encodeURIComponent(key);

      const resp = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (!resp.ok) {
        const errText = await resp.text();
        console.error("Gemini error:", resp.status, errText);
        showStatus("Gemini error: " + resp.status, "err");
        throw new Error(errText);
      }

      const data = await resp.json();
      const text =
        data?.candidates?.[0]?.content?.parts?.[0]?.text ||
        "(Gemini returned no text)";
      
      showStatus("AI response received.", "ok");
      return text.trim();
    }

    // ---------- PROMPT BUILDER ----------
    function buildBaseInstructions() {
      return `
You are an expert Roblox-style rant narrator with fast pacing, Gen-Z humor, dramatic escalation, and punchy lines.
You ALWAYS start with "I'm starting to realize..."
Write short, sharp, rhythmic lines for TikTok / YouTube Shorts rant style.
You NEVER use emojis or hashtags.
You NEVER break character and NEVER mention AI.

SAFETY RULES:
- No slurs, hate speech, bullying, discrimination.
- No sexual content.
- PG-13 frustration allowed only when spicy mode is ON.
- No graphic violence, self-harm, or dangerous themes.
`;
    }

    function buildRantPrompt(mode) {
      const topic = document.getElementById('topicInput').value.trim();
      const pasted = document.getElementById('pasteInput').value.trim();
      const intensity = Number(intensitySlider.value);
      const lengthVal = Number(lengthSlider.value);
      const includeSlang = document.getElementById('includeSlang').checked;
      const spicy = document.getElementById('spicyMode').checked;
      const narrator = document.getElementById('narratorSelect').value;
      const outputText = document.getElementById('output').innerText.trim();

      // Intensity descriptor
      let intensityLabel = ['Very chill', 'Cool', 'Salty', 'Full meltdown'][intensity - 1];

      // Length descriptor
      let lengthLabel = ['short', 'medium', 'long', 'extra long'][lengthVal - 1];

      // Narrator voice
      let narratorDesc = {
        male: "a male Roblox rant narrator",
        female: "a slightly sassy feminine narrator",
        neutral: "a gender-neutral narrator"
      }[narrator];

      let styleBlock = `
STYLE:
- Narrator: ${narratorDesc}
- Intensity: ${intensityLabel}
- Length: ${lengthLabel}
${includeSlang ? "- Gen-Z slang allowed\n" : "- Minimal slang\n"}
${spicy ? "- PG-13 spicy frustration words allowed (no F-bombs)\n" : "- Clean language only\n"}
`;

      let taskBlock = "";

      if (mode === "generate") {
        const safeTopic =
          topic || "a chaotic real-life situation (school, parents, lag, drama, adulting)";
        taskBlock = `
TASK:
Write a Roblox-style rant starting with "I'm starting to realize..."
Topic: "${safeTopic}"
Make it fast, funny, relatable, escalating, and viral-ready.
`;
      }

      else if (mode === "rewrite") {
        const baseText = pasted || outputText || "(no script provided)";
        taskBlock = `
TASK:
Rewrite and improve this rant into a more viral Roblox-style version:
"""${baseText}"""
`;
      }

      else if (mode === "shuffle") {
        const safeTopic =
          topic || "a relatable chaotic situation in daily life";
        taskBlock = `
TASK:
Write a NEW rant variation about:
"${safeTopic}"
Different jokes, different angle ‚Äî same theme.
`;
      }

      else if (mode === "punchier") {
        const baseText = pasted || outputText || "(no script provided)";
        taskBlock = `
TASK:
Make this rant more unique, punchy, clean, and viral:
"""${baseText}"""
`;
      }

      return buildBaseInstructions() + "\n" + styleBlock + "\n" + taskBlock;
    }

    // ---------- BUTTON HANDLERS ----------
    const outputEl = document.getElementById("output");

    async function handleGenerate() {
      try {
        const prompt = buildRantPrompt("generate");
        const text = await callGemini(prompt);
        outputEl.textContent = text;
      } catch (err) {
        console.error(err);
      }
    }

    async function handleRewrite() {
      try {
        const prompt = buildRantPrompt("rewrite");
        const text = await callGemini(prompt);
        outputEl.textContent = text;
      } catch (err) {
        console.error(err);
      }
    }

    async function handleShuffle() {
      try {
        const prompt = buildRantPrompt("shuffle");
        const text = await callGemini(prompt);
        outputEl.textContent = text;
      } catch (err) {
        console.error(err);
      }
    }

    async function handlePunchier() {
      try {
        const prompt = buildRantPrompt("punchier");
        const text = await callGemini(prompt);
        outputEl.textContent = text;
      } catch (err) {
        console.error(err);
      }
    }

    function handleCopy() {
      const txt = outputEl.textContent || "";
      if (!txt.trim()) return;
      navigator.clipboard.writeText(txt);
    }

    document.getElementById('generateBtn').addEventListener('click', handleGenerate);
    document.getElementById('rewriteBtn').addEventListener('click', handleRewrite);
    document.getElementById('shuffleBtn').addEventListener('click', handleShuffle);
    document.getElementById('punchierBtn').addEventListener('click', handlePunchier);
    document.getElementById('copyBtn').addEventListener('click', handleCopy);
  </script>

</body>
</html>
